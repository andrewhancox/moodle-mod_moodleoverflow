{"version":3,"file":"rating.min.js","sources":["../src/rating.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Implements rating functionality\n *\n * @module     mod_moodleoverflow/rating\n * @copyright  2022 Justus Dieckmann WWU\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport Ajax from 'core/ajax';\n// Import Prefetch from 'core/prefetch';\n// import Templates from 'core/templates';\n// import {get_string as getString} from 'core/str';\n\nconst RATING_DOWNVOTE = 1;\nconst RATING_UPVOTE = 2;\nconst RATING_REMOVE_DOWNVOTE = 10;\nconst RATING_REMOVE_UPVOTE = 20;\n\nconst root = document.getElementById('moodleoverflow-root');\n\n/**\n * Send a vote via AJAX\n * @param {int} postid\n * @param {int} rating\n * @param {int} userid\n * @returns {Promise<*>}\n */\nasync function sendVote(postid, rating, userid) {\n    const response = await Ajax.call([{\n        methodname: 'mod_moodleoverflow_record_vote',\n        args: {\n            postid: postid,\n            ratingid: rating\n        }\n    }])[0];\n    root.querySelectorAll(`[data-moodleoverflow-userreputation=\"${userid}\"]`).forEach((i) => {\n        i.textContent = response.raterrepuation;\n    });\n    root.querySelectorAll(`[data-moodleoverflow-userreputation=\"${response.ownerid}\"]`).forEach((i) => {\n        i.textContent = response.ownerreputation;\n    });\n    root.querySelectorAll(`[data-moodleoverflow-postreputation=\"${postid}\"]`).forEach((i) => {\n        i.textContent = response.postrating;\n    });\n    return response;\n}\n\n\n/**\n * Init function.\n *\n * @param {int} userid\n */\nexport function init(userid) {\n    root.onclick = (event) => {\n        const actionElement = event.target.closest('[data-moodleoverflow-action]');\n        if (!actionElement) {\n            return;\n        }\n\n        const action = actionElement.getAttribute('data-moodleoverflow-action');\n        const postElement = actionElement.closest('[data-moodleoverflow-postid]');\n        const postid = postElement?.getAttribute('data-moodleoverflow-postid');\n\n        switch (action) {\n            case 'upvote':\n            case 'downvote': {\n                const isupvote = action === 'upvote';\n                if (actionElement.getAttribute('data-moodleoverflow-state') === 'clicked') {\n                    sendVote(postid, isupvote ? RATING_REMOVE_UPVOTE : RATING_REMOVE_DOWNVOTE, userid);\n                    actionElement.setAttribute('data-moodleoverflow-state', 'notclicked');\n                } else {\n                    sendVote(postid, isupvote ? RATING_UPVOTE : RATING_DOWNVOTE, userid);\n                    actionElement.setAttribute('data-moodleoverflow-state', 'clicked');\n                    const otherElement = postElement.querySelector(\n                        `[data-moodleoverflow-action=\"${(isupvote ? 'downvote' : 'upvote')}\"]`);\n                    otherElement.setAttribute('data-moodleoverflow-state', 'notclicked');\n                }\n            }\n        }\n    };\n\n}"],"names":["userid","root","onclick","event","actionElement","target","closest","action","getAttribute","postElement","postid","isupvote","sendVote","setAttribute","querySelector","document","getElementById","rating","response","Ajax","call","methodname","args","ratingid","querySelectorAll","forEach","i","textContent","raterrepuation","ownerid","ownerreputation","postrating"],"mappings":";;;;;;;oFAmEqBA,QACjBC,KAAKC,QAAWC,cACNC,cAAgBD,MAAME,OAAOC,QAAQ,oCACtCF,2BAICG,OAASH,cAAcI,aAAa,8BACpCC,YAAcL,cAAcE,QAAQ,gCACpCI,OAASD,MAAAA,mBAAAA,YAAaD,aAAa,qCAEjCD,YACC,aACA,kBACKI,SAAsB,WAAXJ,UAC+C,YAA5DH,cAAcI,aAAa,6BAC3BI,SAASF,OAAQC,SArDR,GADE,GAsDgEX,QAC3EI,cAAcS,aAAa,4BAA6B,kBACrD,CACHD,SAASF,OAAQC,SA1Df,EADE,EA2DyDX,QAC7DI,cAAcS,aAAa,4BAA6B,WACnCJ,YAAYK,qDACIH,SAAW,WAAa,gBAChDE,aAAa,4BAA6B,6EA1DrEZ,KAAOc,SAASC,eAAe,sCAStBJ,SAASF,OAAQO,OAAQjB,cAC9BkB,eAAiBC,cAAKC,KAAK,CAAC,CAC9BC,WAAY,iCACZC,KAAM,CACFZ,OAAQA,OACRa,SAAUN,WAEd,UACJhB,KAAKuB,gEAAyDxB,cAAYyB,SAASC,IAC/EA,EAAEC,YAAcT,SAASU,kBAE7B3B,KAAKuB,gEAAyDN,SAASW,eAAaJ,SAASC,IACzFA,EAAEC,YAAcT,SAASY,mBAE7B7B,KAAKuB,gEAAyDd,cAAYe,SAASC,IAC/EA,EAAEC,YAAcT,SAASa,cAEtBb"}